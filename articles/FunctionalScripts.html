<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
    
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>FunctionalScripts | Chaos Server Docs </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="FunctionalScripts | Chaos Server Docs ">
      <meta name="generator" content="docfx 2.59.4.0">
      
      <link rel="shortcut icon" href="../images/chaos.ico">
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/night-owl.min.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" integrity="sha384-EvBWSlnoFgZlXJvpzS+MAUEjvN7+gcCwH+qh7GRFOGgZO0PuwOFro7qPOJnLfe7l" crossorigin="anonymous">
      <link rel="stylesheet" href="../styles/config.css">
      <link rel="stylesheet" href="../styles/discord.css">
      <link rel="stylesheet" href="../styles/singulink.css">
      <link rel="stylesheet" href="../styles/main.css">
      <meta property="docfx:navrel" content="../toc.html">
      <meta property="docfx:tocrel" content="toc.html">
      
      <meta property="docfx:rel" content="../">
      <meta property="docfx:newtab" content="true">
    </head>
    <body>
        <div class="top-navbar">
            <a class="burger-icon" onclick="toggleMenu()">
                <svg name="Hamburger" style="vertical-align: middle;" width="34" height="34" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M20 6H4V9H20V6ZM4 10.999H20V13.999H4V10.999ZM4 15.999H20V18.999H4V15.999Z"></path></svg>
            </a>

            
            <a class="brand" href="../index.html">
              <img src="../images/chaosico.png" alt="Chaos Server Docs" class="logomark">
              <span class="brand-title">Chaos Server Docs</span>
            </a>        </div>

        <div class="body-content">
            <div id="blackout" class="blackout" onclick="toggleMenu()"></div>

            <nav id="sidebar" role="navigation">
                <div class="sidebar">
                    
                    <div>
                      <div class="mobile-hide">
                        
                        <a class="brand" href="../index.html">
                          <img src="../images/chaosico.png" alt="Chaos Server Docs" class="logomark">
                          <span class="brand-title">Chaos Server Docs</span>
                        </a>  </div>
                    
                      <div class="sidesearch">
                        <form id="search" role="search" class="search">
                            <i class="bi bi-search search-icon"></i>
                            <input type="text" id="search-query" placeholder="Search" autocomplete="off">
                        </form>
                      </div>
                    
                      <div id="navbar">
                      </div>
                    </div>                    <div class="sidebar-item-separator"></div>
                        
                        <div id="sidetoggle">
                          <div id="sidetoc"></div>
                        </div>
                </div>
                <div class="footer">
                  
                  <strong><a href='https://dotnet.github.io/docfx/'>DocFX</a> + <a href='https://www.singulink.com'>Singulink</a> = ♥</strong>
                </div>            </nav>

            <main class="main-panel">
                
                <div id="search-results" style="display: none;">
                  <h1 class="search-list">Search Results for <span></span></h1>
                  <div class="sr-items">
                    <p><i class="bi bi-hourglass-split index-loading"></i></p>
                  </div>
                  <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
                </div>
                <div role="main" class="hide-when-search">
                        
                        <div class="subnav navbar navbar-default">
                          <div class="container hide-when-search" id="breadcrumb">
                            <ul class="breadcrumb">
                              <li></li>
                            </ul>
                          </div>
                        </div>

                    <article class="content wrap" id="_content" data-uid="">
<h1 id="functionalscripts">FunctionalScripts</h1>

<p>Functional scripts are a special kind of script that is handled slightly differently than other scripts. They are used to handle specific
kinds of interactions, and are not tied to any single entity. These scripts can be found under <code>Chaos.Scripts.FunctionalScripts</code>.</p>
<p>These scripts often use <a href="Formulae.html">Formulae</a> for calculations as part of their actions. Any functional scripts that utilize formulae
should be implemented in a way that the formula used is swappable for other implementations of that formula.</p>
<p>Let's use the <a class="xref" href="../api/Chaos.Scripts.FunctionalScripts.ApplyDamage.DefaultApplyDamageScript.html">DefaultApplyDamageScript</a> functional script as
an example.</p>
<pre><code class="lang-csharp">using Chaos.Common.Definitions;
using Chaos.Formulae;
using Chaos.Formulae.Abstractions;
using Chaos.Objects.World;
using Chaos.Objects.World.Abstractions;
using Chaos.Scripting.Abstractions;
using Chaos.Scripts.FunctionalScripts.Abstractions;

namespace Chaos.Scripts.FunctionalScripts.ApplyDamage;

public class DefaultApplyDamageScript : ScriptBase, IApplyDamageScript
{
    public IDamageFormula DamageFormula { get; set; }
    public static string Key { get; } = GetScriptKey(typeof(DefaultApplyDamageScript));

    public DefaultApplyDamageScript() =&gt; DamageFormula = DamageFormulae.Default;

    public virtual void ApplyDamage(
        Creature attacker,
        Creature defender,
        IScript source,
        int damage
    )
    {
        damage = DamageFormula.Calculate(
            attacker,
            defender,
            source,
            damage);

        if (damage &lt;= 0)
            return;

        switch (defender)
        {
            case Aisling aisling:
                aisling.StatSheet.SubtractHp(damage);
                aisling.Client.SendAttributes(StatUpdateType.Vitality);
                aisling.ShowHealth();
                aisling.Script.OnAttacked(attacker, damage);

                if (!aisling.IsAlive)
                    aisling.Script.OnDeath(attacker);

                break;
            case Monster monster:
                monster.StatSheet.SubtractHp(damage);
                monster.ShowHealth();
                monster.Script.OnAttacked(attacker, damage);

                if (!monster.IsAlive)
                    monster.Script.OnDeath();

                break;
            case Merchant merchant:
                merchant.Script.OnAttacked(attacker, damage);

                break;
        }
    }

    public static IApplyDamageScript Create() =&gt; FunctionalScriptRegistry.Instance.Get&lt;IApplyDamageScript&gt;(Key);
}
</code></pre>
<p>In this class, you can see that this script is used to apply damage to a target, and uses
the <a class="xref" href="../api/Chaos.Formulae.Damage.DefaultDamageFormula.html">DefaultDamageFormula</a> to calculate the damage before it applies it. The formula is
stored by it's interface, making it swappable with other implementations of that interface.</p>
<p>Anything that deals damage should do it through this script, rather than do it directly. This creates a single place where changes and logic
can be made for how damage is applies.</p>
<h3 id="functional-script-construction">Functional Script Construction</h3>
<p>Functional scripts have a strange construction process. Because they generally deal with highly cross-cutting concerns, they should
generally not be created through the IoC container. Instead, they should be created through a static factory method on the implementation.
This static factory should reference the singleton instance of
the <a class="xref" href="../api/Chaos.Scripts.FunctionalScripts.FunctionalScriptRegistry.html">FunctionalScriptRegistry</a>. This class is responsible for creating
functional scripts and injecting any dependencies they may have.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The registry is configured at startup and automatically gathers type data for any implementations
of <a class="xref" href="../api/Chaos.Scripts.FunctionalScripts.Abstractions.IFunctionalScript.html">IFunctionalScript</a>.</p>
</div>
</article>
                </div>

            </main>
        </div>

        
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
        <script type="text/javascript" src="../styles/jquery.twbsPagination.js"></script>
        <script type="text/javascript" src="../styles/url.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
        <script type="text/javascript" src="../styles/docfx.js"></script>
        <script type="text/javascript" src="../styles/singulink.js"></script>
        <script type="text/javascript" src="../styles/main.js"></script>    </body>
</html>
